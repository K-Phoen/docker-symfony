web:
  build: ./docker/web
  working_dir: /srv/app
  links:
    - db
    - memcached
  volumes:
    - ./code:/srv/app
  ports:
    - 80
  environment:
    - SYMFONY__SECRET=foo_bar_baz
    - SYMFONY__MEMCACHED__HOST=memcached
    - SYMFONY__MEMCACHED__PORT=11211

db:
  image: mysql:latest
  volumes_from:
    - mysqldata

memcached:
  image: kphoen/memcached

mysqldata:
  image: busybox
  volumes:
    - /data

hipache:
  image: hipache
  volumes_from:
    - hipachedata
  links:
    - web
  ports:
    - "80:80"

hipachedata:
  image: busybox
  volumes:
    - /data

rediscli:
  image: redis:latest
  entrypoint: [ redis-cli, -h, hipache ]
  links:
    - hipache
